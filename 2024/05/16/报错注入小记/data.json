{"title":"XPATH报错注入小记","date":"2024-05-16T07:08:09.000Z","source":"_posts/报错注入小记.md","raw":"---\ntitle: XPATH报错注入小记\ndate: 2024-05-16 15:08:09\ntags: [流量分析,Web,安全监控]\n---\n## 简述：\n报错注入的危害主要是查询数据方面，它自己很难做一些如提权之类的动作。\n\n报错注入主要涉及：extractvalue()、updatexml()等。这些函数的功能和注入结果类似，但使用的参数会略有不同。\n\n本文讨论到的报错注入主要是“xml”的报错注入，先讨论**注入点**\n\n简单的来说，在数据库中，一些操作xml文件的函数会遵循一种叫“XPATH”的格式规范。这个规范会比较严格，限制了一些字符。而当数据库查询语句试图调用上面提到的函数时，若给出的查询语句——也就是查询的目标XPATH就会触发“报错”\n\n这里可以发现，触发报错是很容易的，但有报错不一定有注入。安全的查询在报错时只会返回用户所查询的语句，而若存在暴露，数据库会解析extractvalue里存在的一些查询语句并返回，导致攻击者可以通过报错注入去爬取数据库的数据。\n\n## payload案例：\n```\nhttps://xxx.xxx.xxx/xxx/xxx/api/xxx/xxx?xxx=xxx%27%20AND%20EXTRACTVALUE(1,concat(0x7e,database(),0x7e))--%20xxxx\n```\n![alt text](image-7.png)\n## 小结：\n报错注入形式简单，判断简单，是一个可以模板化测试的漏洞（sqlmap）\n而若有蓝队研判需求，主要关注报错注入的返回包是否**没有返回查询语句**而是返回其它一些有的没的。","slug":"报错注入小记","published":true,"updated":"2024-05-16T07:47:06.000Z","_id":"clw8xuz06000878w06jg21lze","comments":true,"layout":"post","photos":[],"html":"<h2><span id=\"简述\">简述：</span></h2><p>报错注入的危害主要是查询数据方面，它自己很难做一些如提权之类的动作。</p>\n<p>报错注入主要涉及：extractvalue()、updatexml()等。这些函数的功能和注入结果类似，但使用的参数会略有不同。</p>\n<p>本文讨论到的报错注入主要是“xml”的报错注入，先讨论<strong>注入点</strong></p>\n<p>简单的来说，在数据库中，一些操作xml文件的函数会遵循一种叫“XPATH”的格式规范。这个规范会比较严格，限制了一些字符。而当数据库查询语句试图调用上面提到的函数时，若给出的查询语句——也就是查询的目标XPATH就会触发“报错”</p>\n<p>这里可以发现，触发报错是很容易的，但有报错不一定有注入。安全的查询在报错时只会返回用户所查询的语句，而若存在暴露，数据库会解析extractvalue里存在的一些查询语句并返回，导致攻击者可以通过报错注入去爬取数据库的数据。</p>\n<h2><span id=\"payload案例\">payload案例：</span></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://xxx.xxx.xxx/xxx/xxx/api/xxx/xxx?xxx=xxx%27%20AND%20EXTRACTVALUE(1,concat(0x7e,database(),0x7e))--%20xxxx</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2024/05/16/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%B0%8F%E8%AE%B0/image-7.png\" alt=\"alt text\"></p>\n<h2><span id=\"小结\">小结：</span></h2><p>报错注入形式简单，判断简单，是一个可以模板化测试的漏洞（sqlmap）<br>而若有蓝队研判需求，主要关注报错注入的返回包是否<strong>没有返回查询语句</strong>而是返回其它一些有的没的。</p>\n","excerpt":"","more":"<h2 id=\"简述：\"><a href=\"#简述：\" class=\"headerlink\" title=\"简述：\"></a>简述：</h2><p>报错注入的危害主要是查询数据方面，它自己很难做一些如提权之类的动作。</p>\n<p>报错注入主要涉及：extractvalue()、updatexml()等。这些函数的功能和注入结果类似，但使用的参数会略有不同。</p>\n<p>本文讨论到的报错注入主要是“xml”的报错注入，先讨论<strong>注入点</strong></p>\n<p>简单的来说，在数据库中，一些操作xml文件的函数会遵循一种叫“XPATH”的格式规范。这个规范会比较严格，限制了一些字符。而当数据库查询语句试图调用上面提到的函数时，若给出的查询语句——也就是查询的目标XPATH就会触发“报错”</p>\n<p>这里可以发现，触发报错是很容易的，但有报错不一定有注入。安全的查询在报错时只会返回用户所查询的语句，而若存在暴露，数据库会解析extractvalue里存在的一些查询语句并返回，导致攻击者可以通过报错注入去爬取数据库的数据。</p>\n<h2 id=\"payload案例：\"><a href=\"#payload案例：\" class=\"headerlink\" title=\"payload案例：\"></a>payload案例：</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://xxx.xxx.xxx/xxx/xxx/api/xxx/xxx?xxx=xxx%27%20AND%20EXTRACTVALUE(1,concat(0x7e,database(),0x7e))--%20xxxx</span><br></pre></td></tr></table></figure>\n<p><img src=\"/2024/05/16/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%B0%8F%E8%AE%B0/image-7.png\" alt=\"alt text\"></p>\n<h2 id=\"小结：\"><a href=\"#小结：\" class=\"headerlink\" title=\"小结：\"></a>小结：</h2><p>报错注入形式简单，判断简单，是一个可以模板化测试的漏洞（sqlmap）<br>而若有蓝队研判需求，主要关注报错注入的返回包是否<strong>没有返回查询语句</strong>而是返回其它一些有的没的。</p>\n","path":"2024/05/16/报错注入小记/","permalink":"http://example.com/2024/05/16/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%B0%8F%E8%AE%B0/","tags":[{"name":"流量分析","_id":"clw8xuz08000e78w09s277a16","slug":"流量分析","path":"tags/流量分析/","permalink":"http://example.com/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/","length":1},{"name":"Web","_id":"clw8xuz08000h78w0gid446z7","slug":"Web","path":"tags/Web/","permalink":"http://example.com/tags/Web/","length":1},{"name":"安全监控","_id":"clw8xuz09000i78w08xt3bprl","slug":"安全监控","path":"tags/安全监控/","permalink":"http://example.com/tags/%E5%AE%89%E5%85%A8%E7%9B%91%E6%8E%A7/","length":1}],"categories":[],"prev":null,"next":{"title":"ctf做题记录-svm","date":"2024-04-30T07:38:52.000Z","slug":"ctf做题记录-svm","published":true,"updated":"2024-05-16T02:31:18.000Z","_id":"clw8xuyzs000078w04zxofv0s","layout":"post","photos":[],"excerpt":"","path":"2024/04/30/ctf做题记录-svm/","permalink":"http://example.com/2024/04/30/ctf%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95-svm/","__post":true},"__post":true}