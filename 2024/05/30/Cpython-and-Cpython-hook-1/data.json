{"title":"Cpython and Cpython hook -1","date":"2024-05-30T09:16:26.000Z","source":"_posts/Cpython-and-Cpython-hook-1.md","raw":"---\ntitle: Cpython and Cpython hook -1\ndate: 2024-05-30 17:16:26\ntags: Python\n---\ntest.pyx\n```python\ndef a(arg):\n    print(arg)\n\n\ndef b(arg):\n    print(arg)\n```\nsetup.py\n```python\nfrom setuptools import setup\nfrom Cython.Build import cythonize\n\nsetup(\n    ext_modules=cythonize(\"./test.pyx\")\n)\n```\n编译指令：\n```bash\npython .\\setup.py build_ext --inplace\n```\n这里--inplace可不要。添加该选项可让编译的库输出到工作目录下\ntest_import.py\n```python\nimport test\nprint(dir(test))\n\na = test.a\n\n\ndef hook_a(arg):\n    print(\"hook a\")\n    a(arg)\n\n\ntest.a = hook_a\ntest.a(1)\n\n```\n```bash\n['__builtins__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', '__test__', 'a', 'b']\nhook a\n1\n```\n","slug":"Cpython-and-Cpython-hook-1","published":true,"updated":"2024-05-31T02:16:48.000Z","_id":"clwu1y97t000044w0aldyge5y","comments":true,"layout":"post","photos":[],"html":"<p>test.pyx</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">a</span>(<span class=\"params\">arg</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(arg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">b</span>(<span class=\"params\">arg</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(arg)</span><br></pre></td></tr></table></figure>\n<p>setup.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> setuptools <span class=\"keyword\">import</span> setup</span><br><span class=\"line\"><span class=\"keyword\">from</span> Cython.Build <span class=\"keyword\">import</span> cythonize</span><br><span class=\"line\"></span><br><span class=\"line\">setup(</span><br><span class=\"line\">    ext_modules=cythonize(<span class=\"string\">&quot;./test.pyx&quot;</span>)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>编译指令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python .\\setup.py build_ext --inplace</span><br></pre></td></tr></table></figure>\n<p>这里–inplace可不要。添加该选项可让编译的库输出到工作目录下<br>test_import.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> test</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">dir</span>(test))</span><br><span class=\"line\"></span><br><span class=\"line\">a = test.a</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hook_a</span>(<span class=\"params\">arg</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;hook a&quot;</span>)</span><br><span class=\"line\">    a(arg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">test.a = hook_a</span><br><span class=\"line\">test.a(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;__builtins__&#x27;</span>, <span class=\"string\">&#x27;__doc__&#x27;</span>, <span class=\"string\">&#x27;__file__&#x27;</span>, <span class=\"string\">&#x27;__loader__&#x27;</span>, <span class=\"string\">&#x27;__name__&#x27;</span>, <span class=\"string\">&#x27;__package__&#x27;</span>, <span class=\"string\">&#x27;__spec__&#x27;</span>, <span class=\"string\">&#x27;__test__&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>]</span><br><span class=\"line\">hook a</span><br><span class=\"line\">1</span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<p>test.pyx</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">a</span>(<span class=\"params\">arg</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(arg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">b</span>(<span class=\"params\">arg</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(arg)</span><br></pre></td></tr></table></figure>\n<p>setup.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> setuptools <span class=\"keyword\">import</span> setup</span><br><span class=\"line\"><span class=\"keyword\">from</span> Cython.Build <span class=\"keyword\">import</span> cythonize</span><br><span class=\"line\"></span><br><span class=\"line\">setup(</span><br><span class=\"line\">    ext_modules=cythonize(<span class=\"string\">&quot;./test.pyx&quot;</span>)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>编译指令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python .\\setup.py build_ext --inplace</span><br></pre></td></tr></table></figure>\n<p>这里–inplace可不要。添加该选项可让编译的库输出到工作目录下<br>test_import.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> test</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">dir</span>(test))</span><br><span class=\"line\"></span><br><span class=\"line\">a = test.a</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hook_a</span>(<span class=\"params\">arg</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;hook a&quot;</span>)</span><br><span class=\"line\">    a(arg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">test.a = hook_a</span><br><span class=\"line\">test.a(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;__builtins__&#x27;</span>, <span class=\"string\">&#x27;__doc__&#x27;</span>, <span class=\"string\">&#x27;__file__&#x27;</span>, <span class=\"string\">&#x27;__loader__&#x27;</span>, <span class=\"string\">&#x27;__name__&#x27;</span>, <span class=\"string\">&#x27;__package__&#x27;</span>, <span class=\"string\">&#x27;__spec__&#x27;</span>, <span class=\"string\">&#x27;__test__&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>]</span><br><span class=\"line\">hook a</span><br><span class=\"line\">1</span><br></pre></td></tr></table></figure>\n","path":"2024/05/30/Cpython-and-Cpython-hook-1/","permalink":"http://example.com/2024/05/30/Cpython-and-Cpython-hook-1/","tags":[{"name":"Python","_id":"clwu1y97x000144w04s5le34x","slug":"Python","path":"tags/Python/","permalink":"http://example.com/tags/Python/","length":1}],"categories":[],"prev":{"title":"a adjustment about unresolved stack usage in binary ninja","date":"2024-06-17T02:03:34.000Z","slug":"a-adjustment-about-unresolved-stack-usage-in-binary-ninja","published":true,"updated":"2024-06-17T02:31:16.000Z","_id":"clxicygqk0000o4w0apfpffzs","layout":"post","photos":[],"excerpt":"","path":"2024/06/17/a-adjustment-about-unresolved-stack-usage-in-binary-ninja/","permalink":"http://example.com/2024/06/17/a-adjustment-about-unresolved-stack-usage-in-binary-ninja/","__post":true},"next":{"title":"XPATH报错注入小记","date":"2024-05-16T07:08:09.000Z","slug":"报错注入小记","published":true,"updated":"2024-05-16T07:47:06.000Z","_id":"clw8xuz06000878w06jg21lze","layout":"post","photos":[],"excerpt":"","path":"2024/05/16/报错注入小记/","permalink":"http://example.com/2024/05/16/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%B0%8F%E8%AE%B0/","__post":true},"__post":true}